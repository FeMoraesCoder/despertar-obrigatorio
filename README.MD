# Despertar Obrigat√≥rio üí°‚è∞

Um script em Python para assumir o controle local de l√¢mpadas inteligentes (ecossistema Tuya / Positivo) e criar um despertador √† prova de falhas e autossabotagem. 

O aplicativo oficial limita as automa√ß√µes. Este projeto utiliza a biblioteca `tinytuya` para enviar comandos locais via rede Wi-Fi, garantindo um despertar suave e, se necess√°rio, m√©todos extremos para for√ßar o usu√°rio a sair da cama.

## üöÄ Funcionalidades Atuais

* **Fase 1 - Despertar Suave:** Inicia a l√¢mpada em 1% de brilho (cor quente) e aumenta gradativamente at√© 100% durante o tempo estipulado.
* **Sistema Antifraude:** Se o usu√°rio tentar apagar a l√¢mpada pelo interruptor ou aplicativo durante o despertar, o script detecta a queda de status e religa a luz imediatamente na cara do usu√°rio.
* **Fase 2 - Modo Insuport√°vel:** Se o alarme n√£o for desarmado a tempo, a l√¢mpada entra em um loop de *strobo* policial (vermelho e azul no brilho m√°ximo).
* **Desarme Inteligente:** Para parar o alarme (Fase 1) ou o strobo (Fase 2), o usu√°rio √© obrigado a interagir com o aplicativo e mudar os modos de ilumina√ß√£o (Cor/Branco), travando a l√¢mpada em luz branca fria (100%) para inibir a melatonina.

## üõ†Ô∏è Tecnologias Utilizadas

* **Python 3**
* **tinytuya:** Para comunica√ß√£o na rede local com dispositivos do ecossistema Tuya.
* **python-dotenv:** Para gerenciamento seguro de credenciais locais.

## ‚öôÔ∏è Como Configurar e Rodar (Linux/Fedora)

1. Clone este reposit√≥rio:
   ```bash
   git clone git@github.com:seu_usuario/despertar-obrigatorio.git
   cd despertar-obrigatorio
   ```

2. Crie e ative um ambiente virtual:
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```

3. Instale as depend√™ncias:
   ```bash
   pip install tinytuya python-dotenv
   ```

4. **Extra√ß√£o das Chaves:** Voc√™ precisar√° criar um projeto na [Tuya IoT Platform](https://iot.tuya.com/) e usar o `tinytuya wizard` para extrair o Device ID, IP Local e a Local Key da sua l√¢mpada.

5. Crie um arquivo `.env` na raiz do projeto e insira as suas credenciais (este arquivo √© ignorado pelo Git por seguran√ßa):
   ```env
   BULB_DEVICE_ID=seu_device_id
   BULB_IP=192.168.0.X
   BULB_LOCAL_KEY=sua_local_key
   ```

6. Execute o script:
   ```bash
   python main.py
   ```

## üó∫Ô∏è Roadmap e Melhorias Futuras

As pr√≥ximas implementa√ß√µes ser√£o gerenciadas via [Issues](../../issues) neste reposit√≥rio:

- [ ] **Agendamento Autom√°tico (CRON):** Configurar a execu√ß√£o do script no sistema operacional (via `cron` no Linux) para rodar automaticamente nos hor√°rios definidos.
- [ ] **Intelig√™ncia de Calend√°rio:** Integrar uma API de Feriados Nacionais/Regionais para validar dias √∫teis. O script deve decidir sozinho se deve ou n√£o tocar.
- [ ] **Desarme F√≠sico (Tag NFC):** Criar uma rota web local (via Flask ou FastAPI) para desarmar o alarme apenas quando o celular for aproximado de uma Tag NFC colada no espelho do banheiro.
- [ ] **Desarme via QR Code:** Alternativa ao NFC, for√ßando a leitura de um QR Code impresso em outro c√¥modo.
- [ ] **Integra√ß√£o Clim√°tica:** Ajustar a temperatura da luz do despertar baseado na temperatura externa via API de clima (ex: dias muito frios ou chuvosos recebem uma luz um pouco mais quente e prolongada).